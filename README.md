# AI SQL Query Agent

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ –≤ SQL-–∑–∞–ø—Ä–æ—Å—ã –∏ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ PostgreSQL.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –≤ SQL
- üîÑ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- üìä –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –≤—ã–≤–æ–¥–∞ (TABLE, JSON, CSV, PLAIN)
- üìù –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚öôÔ∏è –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- C++17 –∏–ª–∏ –≤—ã—à–µ
- CMake 3.15+
- PostgreSQL 12+
- libpqxx
- nlohmann/json

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Ubuntu/Debian/Astra linux
```bash
sudo apt-get install libpqxx-dev nlohmann-json3-dev postgresql-server-dev-all
```

### Arch linux
```bash
sudo pacman -S libpqxx nlohmann-json postgresql-libs
```

## –°–±–æ—Ä–∫–∞

```bash
cmake -S /home/andrew/Projects/Ai_c-_bot_psql -B /home/andrew/Projects/Ai_c-_bot_psql/build
cmake --build /home/andrew/Projects/Ai_c-_bot_psql/build -j
```

## –ó–∞–ø—É—Å–∫ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (–æ–±—É—á–µ–Ω–∏–µ/–∏–Ω—Ñ–µ—Ä–µ–Ω—Å)

- –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ (–±–µ–∑ –æ–±—É—á–µ–Ω–∏—è):
```bash
/home/andrew/Projects/Ai_c-_bot_psql/build/bin/train_model 0 0.001 --resume
```

- –î–æ–æ–±—É—á–µ–Ω–∏–µ —Å —á–µ–∫–ø–æ–π–Ω—Ç–∞ (–ø—Ä–∏–º–µ—Ä: 20 —ç–ø–æ—Ö):
```bash
/home/andrew/Projects/Ai_c-_bot_psql/build/bin/train_model 20 0.001 --resume
```

- –û–±—É—á–µ–Ω–∏–µ —Å –Ω—É–ª—è (–ø—Ä–∏–º–µ—Ä: 50 —ç–ø–æ—Ö):
```bash
/home/andrew/Projects/Ai_c-_bot_psql/build/bin/train_model 50 0.001
```

- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –∏–∑ `training_data/` (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å):
```bash
/home/andrew/Projects/Ai_c-_bot_psql/build/bin/train_model_data 0 0.001 --resume
```

## –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
/home/andrew/Projects/Ai_c-_bot_psql/build/bin/AIQueryAgent
```

## –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è PyTorch C++

```bash
/home/andrew/Projects/Ai_c-_bot_psql/build/bin/test_model
```

## –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±—É—á–µ–Ω–∏—é –Ω–µ–π—Ä–æ—Å–µ—Ç–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞

–î–∞—Ç–∞—Å–µ—Ç —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç **10000 –ø—Ä–∏–º–µ—Ä–æ–≤** SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–∞–π–ª–µ `training_data/nl_to_sql_train.json`.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
cd training_data
python3 expand_dataset.py
```

### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

#### 1. –û–±—É—á–µ–Ω–∏–µ —Å –Ω—É–ª—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

–û–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –∏–∑ 10000 –ø—Ä–∏–º–µ—Ä–æ–≤:

```bash
# 50 —ç–ø–æ—Ö, learning rate 0.001
./build/bin/train_model 50 0.001

# –ò–ª–∏ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–Ω–µ—Ä–æ–º
./build/bin/train_model_data 50 0.001
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ü–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 50-100 –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è)
- –í—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç: learning rate (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 0.001)

**–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è:** ~30-40 –º–∏–Ω—É—Ç –Ω–∞ CPU –¥–ª—è 50 —ç–ø–æ—Ö

#### 2. –î–æ–æ–±—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª–∏

–ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —á–µ–∫–ø–æ–π–Ω—Ç–∞:

```bash
# 20 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–ø–æ—Ö
./build/bin/train_model 20 0.001 --resume

# –ò–ª–∏ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–Ω–µ—Ä–æ–º
./build/bin/train_model_data 20 0.001 --resume
```

**–§–ª–∞–≥ `--resume`:** –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª—å –∏–∑ `models/seq2seq_model_encoder.pt` –∏ `models/seq2seq_model_decoder.pt`

#### 3. –ò–Ω—Ñ–µ—Ä–µ–Ω—Å (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è)

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö:

```bash
# 0 —ç–ø–æ—Ö = —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
./build/bin/train_model 0 0.001 --resume
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:
- `models/seq2seq_model_encoder.pt` - –≤–µ—Å–∞ —ç–Ω–∫–æ–¥–µ—Ä–∞
- `models/seq2seq_model_decoder.pt` - –≤–µ—Å–∞ –¥–µ–∫–æ–¥–µ—Ä–∞
- `models/seq2seq_model_nl_vocab.txt` - —Å–ª–æ–≤–∞—Ä—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞
- `models/seq2seq_model_sql_vocab.txt` - —Å–ª–æ–≤–∞—Ä—å SQL

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

–í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏
- –°—Ä–µ–¥–Ω–∏–π loss –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏
- –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 —ç–ø–æ—Ö
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
Epoch 1/50 [==================================================] 100% (35s) Loss: 2.3456
Epoch 2/50 [==================================================] 100% (33s) Loss: 1.8923
...
Example predictions after epoch 5:
  NL: Count all products
  Pred SQL: select count( *) from products
  True SQL: SELECT COUNT(*) FROM products
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±—É—á–µ–Ω–∏—é

1. **–ü–µ—Ä–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ:** 50-100 —ç–ø–æ—Ö —Å learning rate 0.001
2. **–î–æ–æ–±—É—á–µ–Ω–∏–µ:** 10-20 —ç–ø–æ—Ö —Å —Ç–µ–º –∂–µ learning rate
3. **Fine-tuning:** 5-10 —ç–ø–æ—Ö —Å –º–µ–Ω—å—à–∏–º learning rate (0.0001)
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°–ª–µ–¥–∏—Ç–µ –∑–∞ loss - –æ–Ω –¥–æ–ª–∂–µ–Ω —É–º–µ–Ω—å—à–∞—Ç—å—Å—è. –ï—Å–ª–∏ loss –ø–µ—Ä–µ—Å—Ç–∞–ª –ø–∞–¥–∞—Ç—å, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ.

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (–∏–Ω—Ñ–µ—Ä–µ–Ω—Å)
./build/bin/train_model 0 0.001 --resume

# –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ (10 —ç–ø–æ—Ö)
./build/bin/train_model 10 0.001

# –ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (100 —ç–ø–æ—Ö)
./build/bin/train_model 100 0.001

# –î–æ–æ–±—É—á–µ–Ω–∏–µ —Å –º–µ–Ω—å—à–∏–º learning rate
./build/bin/train_model 20 0.0001 --resume
```